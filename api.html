<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>libgit2 API</title>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
		<link href="stylesheets/application.css" media="all" rel="stylesheet" type="text/css"/>
		<link href="stylesheets/sunburst.css" media="all" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="js/sh_main.min.js"></script>
		<script type="text/javascript" src="js/sh_lang/sh_c.min.js"></script>
		<script type="text/javascript" src="js/sh_lang/sh_ruby.min.js"></script>
		<link type="text/css" href="stylesheets/sh_libgit.css" rel="stylesheet" >
	</head>

	<body onload="sh_highlightDocument();">
		<div id="body"><div id="contents">
			<div id="header">
        <h1>LibGit2 API Usage Guide</h1>
			</div>

			<h2 id="started">Getting started</h2>

			<div class="contents"><div class="bullet">
				<div class="description">
					<p>This is the usage guide for the libgit2 API.  The machine generated
						documentation for the C API can be found <a href="http://libgit2.github.com/libgit2/modules.html">here</a>;
						this page is to show some examples and usage of libgit2 and the Ruby
						bindings, <a href="https://github.com/libgit2/rugged">Rugged</a>.
					</p>

					<p>To get started, you need to initialize the <code>Repository</code>
					object.  This is the starting point for most of what you will do with
					the libgit2 API.
					</p>

<span class="shtitle">C</span>
<pre class="sh_c">
#include &lt;git.h&gt;
git_repository *repo;
git_repository_open(&repo, "/path/to/repo.git");
git_repository_free(repo);
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
require 'rugged'
@repo = Rugged::Repository.new(@path)
</pre>

			</div>
			</div></div>



			<h2 id="sha">SHA1 Conversion and Formatting</h2>
			<div class="contents"><div class="bullet">
				<div class="description">

				<p>The Git object database is basically a key-value store wher
				the key for each object is the SHA1 checksum of the contents of
				the object it is storing. This means that working with these SHA1
				values is pretty important.  The SHA1 algorithm returns a 20-byte
				raw value for any content given to it, but in order to be readable
				by people or to even accurately represent it in ASCII, you have to
				convert the value to 40 hex characters.  libgit2 provides helper
				functions to easily do this conversion.</p>

			<h3>Hex to Raw</h3>

<span class="shtitle">C</span>
<pre class="sh_c">
char hex[] = "599955586da1c3ad514f3e65f1081d2012ec862d";
git_oid oid;
git_oid_mkstr(&oid, hex);
printf("Raw 20 bytes: [%s]\n", (&oid)->id);
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
raw = Rugged::hex_to_raw("ce08fe4884650f067bd5703b6a59a8b3b3c99a09")
puts "Raw 20 bytes: #{raw}"
</pre>

			<h3>Raw to Hex</h3>

<span class="shtitle">C</span>
<pre class="sh_c">
git_oid oid;
char out[40];

git_oid_mkraw(&oid, raw);
git_oid_fmt(out, &oid);
printf("SHA hex string: %s\n", out);$
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
hex = Rugged::raw_to_hex(Base64.decode64("FqASNFZ4mrze9Ld1ITwjqL109eA="))
puts "SHA hex string: #{hex}"
</pre>

				</div>
			</div></div>

			<h2 id="sha">Raw Data Reading and Writing</h2>
			<div class="contents"><div class="bullet">
				<div class="description">

				<p>This is the lowest layer of Git access, raw read and write
				access to the object database. With libgit2 you can read the raw
				data of any object out of the database by providing the SHA1 hash
				of that object.  It will pull from loose or packed objects
				transparently.
				</p>

			<h3>Reading Data</h3>

<span class="shtitle">C</span>
<pre class="sh_c">
git_odb *odb;
git_rawobj obj;
git_oid oid;

unsigned char *data;
const char *str_type;
int error;

odb = git_repository_database(repo);
git_oid_mkstr(&oid, "599955586da1c3ad514f3e65f1081d2012ec862d");
error = git_odb_read(&obj, odb, oid);

data = obj.data;  // raw object data
str_type = git_obj_type_to_string(obj.type); // human readable object type
printf("object length and type: %d, %s\n", (int)obj.len, str_type)
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
sha = "599955586da1c3ad514f3e65f1081d2012ec862d"
if @repo.exists(sha)
  data, length, type = @repo.read(sha)
end
</pre>

			<p>We also provide access to write arbitrary content back into
			the object database.  For writing blob contents, this is fine,
			but remember that other types such as commits and trees have very
			specific formats. It would be easy to introduce corrupt objects
			this way.</p>

			<h3>Writing Data</h3>

<span class="shtitle">C</span>
<pre class="sh_c">
git_odb *odb;
git_rawobj obj;
git_oid oid;
int error;
char out[40];

odb = git_repository_database(repo);

(&obj)->data = "any ol content will do";
(&obj)->len  = 22;
(&obj)->type = git_obj_string_to_type("blob");

git_obj_hash(&oid, &obj);
git_oid_fmt(out, &oid);
printf("SHA hex string: %s\n", out);

error = git_odb_write(&oid, odb, &obj);  // actually write to the db
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
content = "any ol content will do"
sha = @repo.hash(content, "blob")  # just gives you the SHA hash
sha = @repo.write(content, "blob") # actually writes to the odb
</pre>

				</div>
			</div></div>

			<h2 id="sha">Object Parsing and Writing</h2>
			<div class="contents"><div class="bullet">
				<div class="description">
					commit, tag, tree and blob parsing and write-back
					tree traversal

<span class="shtitle">C</span>
<pre class="sh_c">
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
</pre>

				</div>
			</div></div>

			<h2 id="sha">Revision Walking</h2>
			<div class="contents"><div class="bullet">
				<div class="description">

<span class="shtitle">C</span>
<pre class="sh_c">
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
</pre>

				</div>
			</div></div>

			<h2 id="sha">Index Manipulation</h2>
			<div class="contents"><div class="bullet">
				<div class="description">

<span class="shtitle">C</span>
<pre class="sh_c">
</pre>

<br/>

<span class="shtitle">Ruby</span>
<pre class="sh_ruby">
</pre>

				</div>
			</div></div>

	<a href="http://github.com/libgit2/libgit2" id="github">
		<img alt="Fork me on GitHub" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" />
	</a>
</body>
</html>
